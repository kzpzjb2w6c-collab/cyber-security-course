# h5 Alice and Bob

## x) Read and summarize

### Schneier 2015: Applied Cryptography. Chapter 1.1 Terminology.
https://learning.oreilly.com/library/view/applied-cryptography-protocols/9781119096726/08_chap01.html#chap01-sec001

- Cryptography is used, when a sender wants to send a message to a receiver and doesn't want anyone to eavesdrop the message.
- In cryptography a message that is written in plain text is encrypted so that it becomes cipher text that is difficult to read. On the receiver side the cipher text is decrypted back to plain text so that it's readable again.
- For computers both plain text and cipher text are both binary data that it can read. In cryptography a key and an algorithm is used to turn plain text into cipher text and then decrypted back again into plain text so that only someone with the right key can read the message.

### Schneier 2015: Applied Cryptography. Chapter 2.5 Communications Using Public-Key Cryptography.
https://learning.oreilly.com/library/view/applied-cryptography-protocols/9781119096726/10_chap02.html#chap02-sec005

- A protocol is a sequence of steps that two or more parties need to follow in order to complete a task. Everyone involved in the process must know and follow the steps.
- Protocols can be found everywhere in life outside computer networks, like voting in an election or ordering food over telephone. Everyone knows how to accomplish those tasks and they have been established over time.
- Cryptographic protocols are needed because human interaction takes often place over computer networks as not all people are honest over the computer networks. This has created a need for protocols so that tasks are accomplished excactly how they are intended. They have created to create trust that is in face-to-face encounters in computer network environment.
- Cryptohraphic protocols are created to prevent eavesdropping and cheating. They formalize interaction over computer network with clear steps so that no one can do or learn more than what is specified in the protocol.

### Karvinen 2023: PGP - Send Encrypted and Signed Message - gpg
https://terokarvinen.com/2023/pgp-encrypt-sign-verify/

- The article explains how to use PGP with the gpg command-line tool to send a message that is both encrypted and signed between two users, Alice and Tero. The demonstration is shown using a Linux system's terminal.
- The key idea about the article is that messages are often sent over an untrusted network, where there is a risk that someone else could eavesdrop and possibly read or modify the communication between the two user. With public keys, the two users can establish trust over their communication without meeting face to face.
- The idea is demonstrated by installing gpg softwate.
- Trust is built by exchanging and verifying public keys, and not by keeping the algorithm as a secret.

## a) Pubkey today. How have I used public key cryptography today or yesterday, outside this homework.
<a href="https://scontent.xx.fbcdn.net/v/t39.8562-6/455962147_1148247109601582_1673264986279156121_n.pdf?_nc_cat=101&ccb=1-7&_nc_sid=e280be&_nc_ohc=UTPsmESzbQsQ7kNvwH9IjDQ&_nc_oc=AdkxZSz5AQLci3hjMe4WIVNn9Tat-bgs4Rr6sYqp0LePM-9yFI2JrmD_2g9GSQ4moEk&_nc_zt=14&_nc_ht=scontent.xx&_nc_gid=o8XwYDua0R8uD7sqTxmncA&oh=00_AfjUho7tArg_rNaN7Mcz1v3L4PK8Ui1LCohQ1YFPOuHNGQ&oe=692A9C19"> WhatsApp whitepaper </a>

- I use Whatsapp quite extensively with my friends to communicate with each other.how
- Whatsapp uses Signal Protocol with end-to-end encryption, which is public key cryptography.
- When I installed my WhatsApp on my phone it created several key pairs:
  - "Identity Key Par": generated at install time
  - "Signed Pre Key": generated at install time, signed by the "Identity Key"
  - "One-Time Pre Keys": key pairs for one time use
- After registration my client uploads public keys to their server that stores them.
- When I communicate with my friends, we use each other's public keys. In the session, WhatsApp client fetches my friend's public keys from their server and uses them together with my own keys to build a secure session.
- After the session has been established, when I chat with my friend my device and their device uses private keys to encrypt and decrypt messages. WhatsApp's servers can only see encrypted data and public keys, not the message content that was shared between me and my friend.

## b) Encrypt a message. 

### Step 1

Refresh the list of available packages from Debian repositories and install software.
- gpg is a GNU Privacy Guard tool that implements OpenPGP encryption and signatures.
- micro is a simple terminal text editor that is used to write a message in the exercise.
- psmisc provides a killall functionality for troubleshooting
  
```bash
sudo apt-get update
sudo apt-get install gpg micro psmisc
```

<img width="826" height="517" alt="password" src="https://github.com/user-attachments/assets/f0d90fa3-e500-4cff-b1e8-dec155fe174c" />

### Step 2

```bash
gpg --gen-key
```
Entered a name and email address for user Nexus.

<img width="826" height="517" alt="Unpacking" src="https://github.com/user-attachments/assets/9b77ea94-e492-4e07-8d57-3fd21ac367a2" />
<img width="826" height="517" alt="Preparing" src="https://github.com/user-attachments/assets/3b8a4242-1ae9-4c55-988f-703a89ce2a45" />
<img width="826" height="517" alt="homenexus gnupgtrustdb gpg trustdb created" src="https://github.com/user-attachments/assets/02bfb049-f378-4c29-967a-01637447b1ae" />




### Step 3

```bash
gpg --fingerprint
```
Shows an "ID" of sorts for the key (a fingerprint), which is then used to verify that we have imported the correct public key and to choose a key to sign.

<img width="826" height="517" alt="homenexus gnupgtrustdb gpg trustdb created" src="https://github.com/user-attachments/assets/52bc88e9-b0a8-4c7f-b5fc-94a06562ef2a" />

### Step 4

```bash
cd
gpg --export --armor --output nexus.pub
ls
head -4 nexus.pub
```
- --export is used to export user's public key
- --armor is used to use only ASCII characters so that the key can easily be copied.
- --output nexus.pub is used to save the exported key into a file called nexus.pub
- ls and head -4 nexus.pub are used to confirm that the file exists.

This file is then needed for the other user 'Alice' to encrypt messages from Nexus and to verify Nexus' signature.
<img width="826" height="517" alt="trust e-, ea  en" src="https://github.com/user-attachments/assets/0ff7b539-d211-4b55-8085-dbf47d694dd3" />

### Step 5

```bash
cd
mkdir alice
chmod og-rwx alice
cd alice
gpg --homedir . --fingerprint
```

- mkdir alice creates a directory to simulate Alice's home folder
- chmod og-rwx alice is used to ensure that only the user can access it.
- cd alice moves me into that directory that I created.
- gpg --homedir . --fingerrpint tells gpg to use the current directory (.) as its home to create a separate keyring for Alice user.

<img width="826" height="517" alt="log export armor -output nexus pub" src="https://github.com/user-attachments/assets/b1df7833-f55a-409e-b3e7-167746cb8651" />

### Step 6

```bash
gpg --homedir . --gen-key
gpg --homedir . --fingerprint
```

- I created a user Alice and their email address.
- --homedir . keeps Alice's keys inside Alice folder where I created Alice's public key.
- --fingerprint now shows Alice's key, which will be share with Nexus to verify Alice's signatures.

<img width="826" height="517" alt="(GnuPG) 2 4 7; Copyright" src="https://github.com/user-attachments/assets/d4c6f413-d742-4ff4-8cfd-80e62f4bcc67" />
<img width="826" height="517" alt="directory" src="https://github.com/user-attachments/assets/28ac61f9-b6b6-4888-91c1-01f95a02eef1" />

### Step 7

```bash
cd
cp -v nexus.pub alice/
```

- cd is used to make sure that I am in the home directory where alice/ exists
- cp -v nexus.pub alice/ copies the public key file into Alice's folder, simulating a situation that Alice received it over the Internet.

<img width="826" height="517" alt="imported" src="https://github.com/user-attachments/assets/04e6742e-9050-468d-9126-bf2e9a2321e0" />

### Step 8

```bash
cd ~/alice
gpg --homedir . --import nexus.pub
gpg --homedir . --fingerprint
```
- cd cd ~/alice is used to move to Alice's directory
- gpg --homedir . --import nexus.pub is used to add Nexus' public key to Alice's keyring
- gpg --homedir . --fingerprin will show Alice's keypar and Nexus' public key

<img width="826" height="517" alt="imported" src="https://github.com/user-attachments/assets/9f2d729a-9696-429c-8e5f-3ffc12586611" />

### Step 9

```bash
gpg --homedir . --sign-key (key)
gpg --homedir . --fingerprint
```
- gpg --homedir . --sign-key (key) is used when Alice uses their key to sign to Nexus' public key.
- gpg --homedir . --fingerprint shows that Nexus' key signed by Alice.

<img width="826" height="517" alt="nore in 10s 1o0 mete -Sign-Key 2323 4842 0096 380C FCF2" src="https://github.com/user-attachments/assets/bdea9af0-55f8-4456-807d-ec519e577932" />
<img width="826" height="517" alt="Are" src="https://github.com/user-attachments/assets/fdd73cfc-7758-4a92-893a-e5d78450e29d" />

### Step 10

```bash
gpg --homedir . --export --armor --output alice.pub
```
- gpg --homedir . --export --output alice.pub exports Alice's public key into alice.pub in ASCII format.
<img width="826" height="517" alt="homenexusalicepubring kbx" src="https://github.com/user-attachments/assets/c28db2f9-a734-496d-a42e-2a38694b19d7" />

### Step 11

This is where I made an error and couldn't proceed until I understood that I had to use the command cd, before the command to go to the nexus' home directory.

```bash
cd
cp -v alice/alice.pub .
```

- cd is used to go to home directory
- cp -v alice/alice.pub is used to copy alice.pub from Alice's directory to nexus' directory.

<img width="826" height="517" alt="homenexusalicepubring kbx" src="https://github.com/user-attachments/assets/1a337038-0b34-4123-8f1f-f85f75e21a65" />
<img width="826" height="517" alt="C6802C7665763349 public key" src="https://github.com/user-attachments/assets/411c6cac-3611-4e36-a02d-4ca8f415af26" />

### Step 12

```bash
gpg --import alice.pub
gpg --fingerprint
```

- gpg --import alice.pub is used to add Alice's public key to nexus' keyring.
- gpg --fingerprint shos nexus' keypair and Alice's public key.

<img width="826" height="517" alt="C6802C7665763349 public key" src="https://github.com/user-attachments/assets/262404ef-d199-45ab-a50b-10483d139368" />

### Step 13

```bash
gpg --sign-key (Alice's key)
gpg --fingerprint
```
- gpg --sign-key (Alice's key) is used by nexus to sign Alice's public key.
- gpg --fingerprint is used to show that Alice's key is signed by nexus.

<img width="826" height="517" alt="C6802C7665763349 public key" src="https://github.com/user-attachments/assets/0246d8d7-e273-49be-bbc3-5cd315ef41b8" />
<img width="826" height="517" alt="sure that you" src="https://github.com/user-attachments/assets/0e8ae775-a858-40f1-9ac3-b5ed649110d0" />

### Step 14

```bash
cd ~/alice
micro message.txt
```
- cd ~/alice is used to make sure that Alice's keyrign is used for gpg --homedir . commands.
- micro message.txt is used to create a file for the message that is then later sent to nexus. Ctrl + S is used to save the file and CTRL + Q is used to exit the text editor.

<img width="826" height="517" alt="pg depth" src="https://github.com/user-attachments/assets/ee8f6182-9522-4a21-8a8e-420cd21413ea" />
<img width="826" height="517" alt="This is my secret message  I&#39;m so happy we have PGP to protect our communicats" src="https://github.com/user-attachments/assets/a12e67c3-c8b3-49fb-9247-87f44828bd00" />

### Step 15

```bash
gpg --homedir . --encrypt --recipient nexus@h5cybersecurity.com.invalid --sign --output encrypted.pgp --armor message.txt
```

- encrypt is used to encrypt the message
- recipient is used to use nexus' public key that can decrypt the message.
- sign is used to sign the message with Alice's key so that nexus can verify that the message is from Alice
- output encrypted.pgp is used to write the result to encrypted.pgp
- armor is used to encode into ASCII so that the message is easier to send over email
- message.txt is the plain text file that is used

<img width="826" height="517" alt="2028-11-231" src="https://github.com/user-attachments/assets/bf31b746-6d10-4990-bed0-f29e1d477018" />

### Step 16

```bash
ls encrypted.pgp
head -4 encrypted.pgp
```

- ls encrypted.pgp is used to make sure that the .pgp file exsists.
- head -4 encrypted.pgp is used to show the encrypted message.
<img width="826" height="517" alt="2028-11-231" src="https://github.com/user-attachments/assets/fa1d9a9c-3e2d-4ba5-bde7-71837b227833" />

### Step 17

```bash
cd
cp -v alice/encrypted.pgp .
gpg --decrypt encrypted.pgp
```

- cd is used to go to nexus' home directory.
- cp -v alice/encrypted.pgp . is used to copy the encrypted message from Alice's directory to nexus' directory to simulate an email message.
- gpg --decrypt encrypted.pgp is used by nexus to decrypt the message and show it.

<img width="826" height="517" alt="aliceencrypted pgp" src="https://github.com/user-attachments/assets/feb575e3-c07d-4dd2-961d-5ff1145233c3" />
















# References
This is related to a course: https://terokarvinen.com/cyber-security/
